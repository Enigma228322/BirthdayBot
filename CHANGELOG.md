# Changelog

## [1.3.0] - 2024-12-19

### Улучшено
- **Обработка лимитов API**: Увеличена задержка с 2 до 3 секунд между запросами
- **Умная обработка "Too Many Requests"**: Автоматическое извлечение времени ожидания из ошибки
- **Система повторных попыток**: До 3 попыток отправки сообщения при ошибках
- **Дополнительные задержки**: 500ms задержка перед обработкой каждой команды
- **Улучшенное логирование**: Более детальная информация о лимитах и повторных попытках

### Технические детали
- Парсинг времени ожидания из сообщения "retry after X"
- Автоматическое ожидание указанного времени + 1 секунда для безопасности
- Fallback на 60 секунд при невозможности извлечь время ожидания
- Задержка 5 секунд для других типов ошибок

## [1.2.0] - 2024-12-19

### Исправлено
- **CMake конфигурация**: Убрана ссылка на несуществующий README.md.in
- **Поддержка Boost**: Добавлен поиск и линковка библиотеки Boost (требуется для tgbot-cpp)
- **Заголовочные файлы spdlog**: Исправлен путь к daily_file_sink.h
- **Конфликты имен переменных**: Переименована переменная `tm` в `current_tm`
- **Линковка библиотек**: Исправлено имя библиотеки с `tgbot` на `TgBot`
- **Скрипт сборки**: Добавлена поддержка macOS (sysctl вместо nproc)

### Технические детали
- Добавлен `find_package(Boost REQUIRED COMPONENTS system)`
- Исправлены все пути к заголовочным файлам
- Улучшена кроссплатформенность сборки

## [1.1.0] - 2024-12-19

### Добавлено
- **Задержки между запросами API**: Добавлена задержка 2 секунды между всеми запросами к Telegram API
- **Улучшенная обработка ошибок**: Автоматический перезапуск long polling при ошибках с задержкой 5 секунд
- **Детальное логирование**: Логирование всех отправленных сообщений на уровне DEBUG

### Изменено
- Все вызовы `bot_.getApi().sendMessage()` заменены на `sendMessageWithDelay()`
- Добавлена обработка исключений в основном цикле long polling
- Обновлена документация с описанием новых возможностей

### Технические детали
- Добавлен приватный метод `sendMessageWithDelay()` в класс `BirthdayBot`
- Использование `std::this_thread::sleep_for()` для задержек
- Улучшенная устойчивость к сетевым сбоям и лимитам API

## [1.0.0] - 2024-12-19

### Добавлено
- Базовая функциональность Telegram бота для отслеживания дней рождения
- Команды `/dr`, `/add` с полной валидацией
- JSON хранение данных пользователей
- Логирование через spdlog
- CMake система сборки
