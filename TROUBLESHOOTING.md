# Руководство по устранению неполадок

## Проблемы с лимитами Telegram API

### Ошибка "Too Many Requests: retry after X"

Эта ошибка возникает, когда бот превышает лимиты Telegram API. Наш бот автоматически обрабатывает эту ситуацию:

1. **Автоматическое ожидание**: Бот извлекает время ожидания из ошибки и ждет указанное время + 1 секунда
2. **Повторные попытки**: До 3 попыток отправки сообщения
3. **Увеличенные задержки**: 3 секунды между запросами вместо 2

### Что делать при частых лимитах:

1. **Увеличьте задержки** (если нужно):
   - Отредактируйте `src/main.cpp`
   - Найдите строку: `this_thread::sleep_for(chrono::seconds(3));`
   - Увеличьте значение (например, до 5 секунд)

2. **Ограничьте количество пользователей**:
   - Не добавляйте бота в большие группы (>1000 участников)
   - Используйте бота только в небольших группах или личных чатах

3. **Мониторинг логов**:
   - Следите за файлом `logs/birthday_bot.log`
   - Ищите сообщения "Rate limited!" и "Too Many Requests"

### Примеры логов при лимитах:

```
[2024-12-19 12:00:00.000] [error] Failed to send message to chat -1001234567890: Too Many Requests: retry after 3594
[2024-12-19 12:00:00.001] [warn] Rate limited! Waiting 3595 seconds before retry...
```

## Другие проблемы

### Бот не отвечает на команды

1. **Проверьте токен**:
   ```bash
   echo $BOT_TOKEN
   ```

2. **Проверьте логи**:
   ```bash
   tail -f logs/birthday_bot.log
   ```

3. **Перезапустите бота**:
   ```bash
   ./run_bot.sh
   ```

### Ошибки сборки

1. **Очистите и пересоберите**:
   ```bash
   rm -rf build
   ./build.sh
   ```

2. **Проверьте зависимости**:
   ```bash
   # macOS
   brew install boost openssl cmake

   # Ubuntu/Debian
   sudo apt-get install libboost-all-dev libssl-dev cmake build-essential
   ```

### Проблемы с JSON файлом

1. **Проверьте права доступа**:
   ```bash
   ls -la birthdays.json
   ```

2. **Создайте файл заново** (если поврежден):
   ```bash
   rm birthdays.json
   # Бот создаст новый файл при первом запуске
   ```

## Рекомендации по производительности

1. **Используйте бота в небольших группах** (< 100 участников)
2. **Не спамьте командами** - давайте боту время на обработку
3. **Мониторьте логи** для раннего выявления проблем
4. **Регулярно проверяйте** файл `birthdays.json` на корректность

## Контакты и поддержка

При возникновении проблем:
1. Проверьте логи в `logs/birthday_bot.log`
2. Убедитесь, что все зависимости установлены
3. Проверьте права доступа к файлам
4. При необходимости увеличьте задержки в коде
